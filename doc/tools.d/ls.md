# ls.ts

## åŠŸèƒ½æ¦‚è¿°

`ls.ts` å®ç°äº†ç›®å½•åˆ—è¡¨å·¥å…·ï¼Œå…è®¸ Agent åˆ—å‡ºæŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œå­ç›®å½•ã€‚è¿™æ˜¯æ–‡ä»¶ç³»ç»Ÿå¯¼èˆªçš„åŸºç¡€å·¥å…·ï¼Œç±»ä¼¼äºå‘½ä»¤è¡Œçš„ `ls` æˆ– `dir` å‘½ä»¤ã€‚

---

## ä¸»è¦å·¥å…·

### `lsTool`

| å±æ€§ | å€¼ |
|------|-----|
| åç§° | `ls` |
| æè¿° | åˆ—å‡ºç»™å®š URI å¤„çš„æ–‡ä»¶å’Œç›®å½• |

**å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | æè¿° |
|------|------|------|------|
| `uri` | `string` | æ˜¯ | è¦åˆ—å‡ºçš„ç›®å½• URI æˆ–è·¯å¾„ |

**æ‰§è¡Œæµç¨‹ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¥æ”¶å‚æ•° uri        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éªŒè¯ uri å‚æ•°       â”‚
â”‚ ä¸èƒ½ä¸ºç©º            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§£æè¾“å…¥ä¸º VS Code  â”‚
â”‚ URI                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯»å–ç›®å½•å†…å®¹        â”‚
â”‚ vscode.workspace.fs.â”‚
â”‚   readDirectory()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ’åºæ¡ç›®            â”‚
â”‚ - ç›®å½•æ’åœ¨æ–‡ä»¶å‰    â”‚
â”‚ - æŒ‰åç§°å­—æ¯é¡ºåº    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ ¼å¼åŒ–è¾“å‡º          â”‚
â”‚ [TYPE] name         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å›ç»“æœ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¿”å›å€¼ï¼š**

| æƒ…å†µ | è¿”å›å€¼ |
|------|--------|
| å‚æ•°ç¼ºå¤± | `'Error: Missing "uri" argument.'` |
| ç©ºç›®å½• | `'(Empty Directory)'` |
| æˆåŠŸ | æ ¼å¼åŒ–çš„æ–‡ä»¶åˆ—è¡¨ |
| é”™è¯¯ | `'Error listing directory: {error}'` |

**è¾“å‡ºæ ¼å¼ï¼š**

```
[DIR ] directory_name
[FILE] file_name.ts
[FILE] another_file.js
[LINK] symbolic_link
[UNKN] unknown_type
```

---

## æ’åºè§„åˆ™

ç›®å½•æ¡ç›®æŒ‰ç…§ä»¥ä¸‹è§„åˆ™æ’åºï¼š

1. **ç±»å‹ä¼˜å…ˆ**ï¼šç›®å½•ï¼ˆ`FileType.Directory`ï¼‰æ’åœ¨æ–‡ä»¶ï¼ˆ`FileType.File`ï¼‰å‰é¢
2. **å­—æ¯é¡ºåº**ï¼šåŒç±»å‹å†…æŒ‰åç§°å­—æ¯é¡ºåºæ’åº

```typescript
entries.sort((a, b) => {
    if (a[1] === b[1]) return a[0].localeCompare(b[0]);
    return a[1] === vscode.FileType.Directory ? -1 : 1;
});
```

---

## æ–‡ä»¶ç±»å‹æ ‡è¯†

| æ ‡è¯† | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `DIR` | ç›®å½• | æ–‡ä»¶å¤¹ |
| `FILE` | æ–‡ä»¶ | æ™®é€šæ–‡ä»¶ |
| `LINK` | ç¬¦å·é“¾æ¥ | ç¬¦å·é“¾æ¥/å¿«æ·æ–¹å¼ |
| `UNKN` | æœªçŸ¥ | å…¶ä»–ç±»å‹ |

---

## ä¾èµ–å…³ç³»

| ä¾èµ– | ç”¨é€” |
|------|------|
| `interface.ts` | `ITool`ã€`ToolContext` æ¥å£ |
| `utils.ts` | `resolveUri` å‡½æ•° |
| `vscode` | VS Code æ–‡ä»¶ç³»ç»Ÿ API |

---

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæ¢ç´¢é¡¹ç›®ç»“æ„

```typescript
// åˆ—å‡ºé¡¹ç›®æ ¹ç›®å½•
const result = await lsTool.execute({
    uri: '/workspace/project'
}, context);
// è¾“å‡º:
// [DIR ] src
// [DIR ] tests
// [FILE] package.json
// [FILE] README.md
```

### åœºæ™¯ 2ï¼šåˆ—å‡ºæºä»£ç ç›®å½•

```typescript
const result = await lsTool.execute({
    uri: '/workspace/project/src'
}, context);
```

### åœºæ™¯ 3ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„

```typescript
const result = await lsTool.execute({
    uri: 'src/components'  // ç›¸å¯¹äºå·¥ä½œåŒºæ ¹ç›®å½•
}, context);
```

### åœºæ™¯ 4ï¼šæ„å»ºæ–‡ä»¶æ ‘

```typescript
async function buildFileTree(dir: string, context: ToolContext, depth = 0): Promise<string> {
    const result = await lsTool.execute({ uri: dir }, context);
    const lines = result.split('\n');
    let tree = '';
    
    for (const line of lines) {
        if (line.startsWith('[DIR]')) {
            const dirName = line.substring(6).trim();
            tree += '  '.repeat(depth) + `ğŸ“ ${dirName}\n`;
            const subDir = `${dir}/${dirName}`;
            tree += await buildFileTree(subDir, context, depth + 1);
        } else if (line.startsWith('[FILE]')) {
            const fileName = line.substring(7).trim();
            tree += '  '.repeat(depth) + `ğŸ“„ ${fileName}\n`;
        }
    }
    
    return tree;
}
```

---

## æ³¨æ„äº‹é¡¹

1. **è·¯å¾„è§£æ**ï¼šæ”¯æŒç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹äºå·¥ä½œåŒºæ ¹ç›®å½•ï¼‰
2. **æƒé™æ£€æŸ¥**ï¼šæ­¤å·¥å…·ä¸æ£€æŸ¥ `allowedUris`ï¼Œå¯åˆ—å‡ºä»»ä½•å¯è®¿é—®ç›®å½•
3. **é”™è¯¯å¤„ç†**ï¼šç›®å½•ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®æ—¶ä¼šè¿”å›é”™è¯¯æ¶ˆæ¯
4. **éšè—æ–‡ä»¶**ï¼šæ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ï¼ˆä»¥ç‚¹å¼€å¤´çš„æ–‡ä»¶ï¼‰
5. **ç¬¦å·é“¾æ¥**ï¼šæ­£ç¡®è¯†åˆ«ç¬¦å·é“¾æ¥ç±»å‹
